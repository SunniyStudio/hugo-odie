{{- $inServerMode := hugo.IsServer }}
{{- $includePaths := (slice "node_modules") }}
{{- $sass         := "scss/custom.scss" }}
{{- $cssOutput    := "css/style.css" }}

{{/* 本地化字体和图标，不再从远程 CDN 加载 */}}
{{- $fontAwesomeVersion := site.Params.font_awesome_version }}
{{- $fonts := site.Params.fonts }}
{{ $scratch := collections.NewScratch }}

{{/* 注释掉远程 Font Awesome URL，使用本地版本 */}}
{{ with $fontAwesomeVersion }}
  {{/* 不再使用远程 URL */}}
  {{ $scratch.Set "font_awesome_url" "" }}
{{ end }}

{{/* 注释掉远程 Google Fonts URL，使用本地版本 */}}
{{ if $fonts }}
  {{/* 不再使用远程 URL */}}
  {{ $scratch.Set "fonts_url" "" }}
{{ end }}

{{/* 引入本地 Font Awesome CSS */}}
<link rel="stylesheet" href="/fontawesome/css/all.min.css">
{{/* 引入本地字体 CSS (Poppins, Open Sans) */}}
<link rel="stylesheet" href="/css/fonts.css">


{{- $v := dict 
    "fonts_url" ($scratch.Get "fonts_url")
    "font_awesome_url" ($scratch.Get "font_awesome_url")
}}

{{- $devOpts      := (dict 
    "transpiler" "dartsass"
    "targetPath" $cssOutput
    "includePaths" $includePaths
    "enableSourceMap" true
    "vars" $v
    "silenceDependencyDeprecations" true
    ) 
}}
{{- $prodOpts     := (dict
    "transpiler" "dartsass"
    "targetPath" $cssOutput
    "includePaths" $includePaths
    "outputStyle" "compressed"
    "silenceDependencyDeprecations" true
    "vars" $v
    )
}}

{{- $cssOpts      := cond $inServerMode $devOpts $prodOpts }}
{{- $css := resources.Get $sass | css.Sass $cssOpts }}

{{- if $inServerMode }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">
{{- else }}
{{- $prodCss      := $css | fingerprint }}
<link rel="stylesheet" href="{{ $prodCss.RelPermalink }}" integrity="{{ $prodCss.Data.Integrity }}">
{{- end }}
